<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fresso Beats</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* –í–°–¢–ê–í–¨ –°–Æ–î–ê –í–ï–°–¨ CSS –ò–ó –ü–†–ï–î–´–î–£–©–ï–ô –†–ê–ë–û–ß–ï–ô –í–ï–†–°–ò–ò */
        /* –¢–æ—Ç –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø–µ—Ä–µ–¥ —Ñ–∞–∑–æ–π 2 */
        
        :root {
            --primary: #8B5CF6;
            --primary-dark: #7C3AED;
            --primary-light: #A78BFA;
            --accent: #F59E0B;
            --bg-dark: #1a1029;
            --bg-card: rgba(45, 45, 66, 0.8);
            --bg-darker: #0f0a1c;
            --text: #FFFFFF;
            --text-secondary: #A0A0B0;
            --success: #10B981;
            --danger: #EF4444;
            --glow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: 
                linear-gradient(135deg, #1a1029 0%, #2d1b69 50%, #1a1029 100%),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(139,92,246,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* –í–°–¢–ê–í–¨ –û–°–¢–ê–õ–¨–ù–û–ô CSS –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô */
        /* ... –≤–µ—Å—å —Ç–≤–æ–π –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ä–∞–±–æ—á–∏–π CSS ... */
    </style>
</head>
<body>
    <!-- –í–°–¢–ê–í–¨ –°–Æ–î–ê –í–ï–°–¨ HTML –ò–ó –ü–†–ï–î–´–î–£–©–ï–ô –†–ê–ë–û–ß–ï–ô –í–ï–†–°–ò–ò -->
    <!-- –¢–æ—Ç –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–ª –¥–æ —Ñ–∞–∑—ã 2 -->

    <script>
        // –í–û–ó–í–†–ê–©–ê–ï–ú –†–ê–ë–û–ß–£–Æ –í–ï–†–°–ò–Æ –ë–ï–ó –§–ê–ó–´ 2
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ö–ê–†–¢–ò–ù–û–ö –î–õ–Ø –ë–ò–¢–û–í
        const beatImages = {
            1: "url('https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=200&h=200&fit=crop')",
            2: "url('https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=200&h=200&fit=crop')", 
            3: "url('https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=200&h=200&fit=crop')",
            4: "url('https://images.unsplash.com/photo-1494232410401-ad00d5433cfa?w=200&h=200&fit=crop')",
        };

        // –î–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const beats = [
            {
                id: 1,
                title: "Midnight Drive",
                bpm: 140,
                key: "C#min",
                genre: "Trap",
                mood: "Dark",
                isNew: true,
                plays: 1245,
                audioUrl: "#",
                isFavorite: false,
                inCart: false
            },
            {
                id: 2,
                title: "Neon Dreams", 
                bpm: 128,
                key: "F#maj",
                genre: "Synthwave",
                mood: "Dreamy",
                isNew: true,
                plays: 892,
                audioUrl: "#",
                isFavorite: true,
                inCart: false
            },
            {
                id: 3,
                title: "Urban Storm",
                bpm: 150,
                key: "Amin",
                genre: "Drill",
                mood: "Aggressive",
                isNew: false,
                plays: 2103,
                audioUrl: "#",
                isFavorite: false,
                inCart: true
            },
            {
                id: 4,
                title: "Crystal Flow",
                bpm: 135,
                key: "G#min",
                genre: "Phonk",
                mood: "Vibey",
                isNew: false,
                plays: 1678,
                audioUrl: "#",
                isFavorite: false,
                inCart: false
            }
        ];

        let currentFilter = 'all';
        const audioPlayers = new Map();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
        function setupNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            const screens = document.querySelectorAll('.screen');

            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const targetScreen = this.getAttribute('data-screen');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                    navItems.forEach(nav => nav.classList.remove('active'));
                    this.classList.add('active');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ü–µ–ª–µ–≤–æ–π —ç–∫—Ä–∞–Ω
                    screens.forEach(screen => screen.classList.add('hidden'));
                    document.getElementById(targetScreen).classList.remove('hidden');
                });
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        function setupFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
                    filterBtns.forEach(b => b.classList.remove('active'));
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
                    this.classList.add('active');
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä
                    currentFilter = this.getAttribute('data-filter');
                    displayBeats();
                });
            });
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –±–∏—Ç–æ–≤
        function filterBeats(beats) {
            if (currentFilter === 'all') return beats;
            
            return beats.filter(beat => {
                switch(currentFilter) {
                    case 'trap': return beat.genre === 'Trap';
                    case 'drill': return beat.genre === 'Drill';
                    case 'phonk': return beat.genre === 'Phonk';
                    case 'lofi': return beat.genre === 'Lo-Fi';
                    case 'bpm-80-120': return beat.bpm >= 80 && beat.bpm <= 120;
                    case 'bpm-120-140': return beat.bpm >= 120 && beat.bpm <= 140;
                    case 'bpm-140': return beat.bpm > 140;
                    default: return true;
                }
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∏—Ç–æ–≤
        function displayBeats() {
            const newBeatsContainer = document.getElementById('newBeats');
            const allBeatsContainer = document.getElementById('allBeats');
            const favoriteBeatsContainer = document.getElementById('favoriteBeats');

            const filteredBeats = filterBeats(beats);

            // –ù–æ–≤—ã–µ –±–∏—Ç—ã (–ø–µ—Ä–≤—ã–µ 2)
            const newBeats = filteredBeats.filter(beat => beat.isNew).slice(0, 2);
            newBeatsContainer.innerHTML = newBeats.map(beat => createBeatCard(beat)).join('');

            // –í—Å–µ –±–∏—Ç—ã
            allBeatsContainer.innerHTML = filteredBeats.map(beat => createBeatCard(beat)).join('');

            // –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –±–∏—Ç—ã
            const favoriteBeats = filterBeats(beats.filter(beat => beat.isFavorite));
            favoriteBeatsContainer.innerHTML = favoriteBeats.map(beat => createBeatCard(beat)).join('');

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É–¥–∏–æ –ø–ª–µ–µ—Ä—ã
            initializeAudioPlayers();
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –±–∏—Ç–∞
        function createBeatCard(beat) {
            const imageStyle = beatImages[beat.id] || 'linear-gradient(135deg, #8B5CF6, #F59E0B)';
            
            return `
                <div class="beat-card fade-in" data-beat-id="${beat.id}">
                    <div class="beat-header">
                        <div class="beat-image" style="background: ${imageStyle}; background-size: cover; background-position: center;">
                            ${getGenreEmoji(beat.genre)}
                        </div>
                        <div class="beat-info">
                            <h3>${beat.title}</h3>
                            <div class="beat-meta">
                                <span>${beat.bpm} BPM</span>
                                <span>${beat.key}</span>
                                <span>${beat.genre}</span>
                                <span>${beat.mood}</span>
                            </div>
                        </div>
                        <div class="beat-actions">
                            <button class="action-btn favorite ${beat.isFavorite ? 'active' : ''}" 
                                    onclick="toggleFavorite(${beat.id})">
                                <i class="fas fa-heart"></i>
                            </button>
                            <button class="action-btn cart ${beat.inCart ? 'active' : ''}" 
                                    onclick="toggleCart(${beat.id})">
                                <i class="fas fa-shopping-cart"></i>
                            </button>
                        </div>
                    </div>
                    <div class="audio-player-container">
                        <div class="custom-audio-player" id="audio-player-${beat.id}">
                            <button class="play-btn" onclick="togglePlay(${beat.id})">
                                <i class="fas fa-play"></i>
                            </button>
                            <div class="progress-container" onclick="seekAudio(${beat.id}, event)">
                                <div class="progress-bar" id="progress-${beat.id}"></div>
                            </div>
                            <div class="time-display" id="time-${beat.id}">0:00</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–º–æ–¥–∑–∏ –¥–ª—è –∂–∞–Ω—Ä–∞
        function getGenreEmoji(genre) {
            const emojiMap = {
                'Trap': 'üéµ',
                'Drill': 'üî´', 
                'Phonk': 'üåÄ',
                'Synthwave': 'üåå',
                'Lo-Fi': '‚òï'
            };
            return emojiMap[genre] || 'üéµ';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –ø–ª–µ–µ—Ä–æ–≤
        function initializeAudioPlayers() {
            beats.forEach(beat => {
                if (!audioPlayers.has(beat.id)) {
                    const audio = new Audio(beat.audioUrl);
                    audioPlayers.set(beat.id, {
                        audio: audio,
                        isPlaying: false
                    });

                    audio.addEventListener('timeupdate', () => updateProgress(beat.id));
                    audio.addEventListener('ended', () => onAudioEnded(beat.id));
                }
            });
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
        function togglePlay(beatId) {
            const playerData = audioPlayers.get(beatId);
            const playBtn = document.querySelector(`#audio-player-${beatId} .play-btn i`);
            
            if (playerData.isPlaying) {
                playerData.audio.pause();
                playBtn.className = 'fas fa-play';
            } else {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –¥—Ä—É–≥–∏–µ –∞—É–¥–∏–æ
                audioPlayers.forEach((data, id) => {
                    if (id !== beatId && data.isPlaying) {
                        data.audio.pause();
                        data.isPlaying = false;
                        document.querySelector(`#audio-player-${id} .play-btn i`).className = 'fas fa-play';
                    }
                });
                
                playerData.audio.play();
                playBtn.className = 'fas fa-pause';
            }
            
            playerData.isPlaying = !playerData.isPlaying;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        function updateProgress(beatId) {
            const playerData = audioPlayers.get(beatId);
            const progress = document.getElementById(`progress-${beatId}`);
            const timeDisplay = document.getElementById(`time-${beatId}`);
            
            if (playerData && playerData.audio.duration) {
                const percent = (playerData.audio.currentTime / playerData.audio.duration) * 100;
                progress.style.width = percent + '%';
                
                // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
                const currentTime = formatTime(playerData.audio.currentTime);
                timeDisplay.textContent = currentTime;
            }
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }

        // –ü–µ—Ä–µ–º–æ—Ç–∫–∞ –∞—É–¥–∏–æ
        function seekAudio(beatId, event) {
            const playerData = audioPlayers.get(beatId);
            const progressContainer = event.currentTarget;
            const rect = progressContainer.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            
            if (playerData && playerData.audio.duration) {
                playerData.audio.currentTime = percent * playerData.audio.duration;
            }
        }

        // –ö–æ–≥–¥–∞ –∞—É–¥–∏–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å
        function onAudioEnded(beatId) {
            const playBtn = document.querySelector(`#audio-player-${beatId} .play-btn i`);
            const playerData = audioPlayers.get(beatId);
            
            playBtn.className = 'fas fa-play';
            playerData.isPlaying = false;
            
            // –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            document.getElementById(`progress-${beatId}`).style.width = '0%';
            document.getElementById(`time-${beatId}`).textContent = '0:00';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
        function toggleFavorite(beatId) {
            const beat = beats.find(b => b.id === beatId);
            beat.isFavorite = !beat.isFavorite;
            displayBeats();
            showNotification(`–ë–∏—Ç "${beat.title}" ${beat.isFavorite ? '–¥–æ–±–∞–≤–ª–µ–Ω' : '—É–¥–∞–ª–µ–Ω'} –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ`);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
        function toggleCart(beatId) {
            const beat = beats.find(b => b.id === beatId);
            beat.inCart = !beat.inCart;
            displayBeats();
            showNotification(`–ë–∏—Ç "${beat.title}" ${beat.inCart ? '–¥–æ–±–∞–≤–ª–µ–Ω' : '—É–¥–∞–ª–µ–Ω'} –≤ –∫–æ—Ä–∑–∏–Ω—É`);
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        function showNotification(message) {
            // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - alert
            alert(message);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            setupNavigation();
            setupFilters();
            displayBeats();
        });
    </script>
</body>
</html>
